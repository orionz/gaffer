#!/usr/bin/env ruby

require File.dirname(__FILE__) + '/../lib/gaffer'

require 'optparse'

optparse = OptionParser.new do|opts|
  opts.banner = <<banner
Usage: gaffer [options] ACTION [ DIR [ DIR [ ... ] ] ] 
banner

  opts.on( '-h', '--help', 'Display this screen' ) do
    puts opts
    exit
  end
end

optparse.parse!

if ARGV.length == 0
elsif ARGV.length == 1
  command, targets = ARGV.shift, [Dir.pwd]
else
  command, targets = ARGV.shift, ARGV
end

command = ARGV.shift
target  = ARGV.shift || Dir::pwd

gaffer = Gaffer::Base.new

case command
when "pull"
  gaffer.pull
when "build"
  gaffer.compile(target)
when "upload"
  gaffer.upload(target)
when "publish"
  gaffer.upload gaffer.compile(target)
else
  puts "No action: --help for help"
  exit 1
end

targets.each do |dir|
  puts "Compiling #{dir}"
end

